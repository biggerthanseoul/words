<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI ì˜ì–´ ë‹¨ì–´ í•™ìŠµ ì•±</title>
  <!-- ì˜¨ë””ë°”ì´ìŠ¤ AI ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ -->
  <script src="https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1"></script>
  <style>
    :root {
      --meaning-bg: #2c3e50;
      --meaning-dark: #22303f;
      --light-gray: #ecf0f1;
      --text-gray: #7f8c8d;
      --accent-blue: #3498db;
      --accent-blue-dark: #2980b9;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', 'Noto Sans KR', sans-serif;
    }
    body {
      background-color: #f5f5f5;
      color: #333;
      line-height: 1.6;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }
    header {
      text-align: center;
      margin-bottom: 20px;
    }
    h1 {
      font-size: 2rem;
      color: #2c3e50;
      margin-bottom: 10px;
    }
    .lang-tabs {
      text-align: center;
      margin-bottom: 20px;
    }
    .lang-btn {
      padding: 8px 16px;
      margin: 0 5px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9rem;
    }
    .lang-btn.active {
      background-color: var(--meaning-bg);
      color: white;
    }
    .lang-btn:not(.active) {
      background-color: var(--light-gray);
      color: var(--text-gray);
    }
    .instructions {
      text-align: center;
      margin: 0 0 20px;
      color: var(--text-gray);
      font-size: 0.9rem;
    }
    .chapter-container {
      margin-bottom: 40px;
    }
    .chapter-title {
      background-color: var(--meaning-bg);
      color: white;
      padding: 10px 15px;
      border-radius: 5px;
      margin-bottom: 15px;
      font-size: 1.2rem;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
    }
    .chapter-title:hover {
      background-color: var(--meaning-dark);
    }
    .chapter-toggle {
      font-size: 1.2rem;
    }
    .words-container {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      overflow: hidden;
      max-height: 0;
      transition: max-height 0.3s ease-out;
    }
    .words-container.expanded {
      max-height: 5000px;
      transition: max-height 0.5s ease-in;
    }
    .word-card {
      width: calc(33.333% - 10px);
      height: 100px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      background-color: white;
      overflow: hidden;
      position: relative;
      perspective: 1000px;
      cursor: pointer;
    }
    @media (max-width: 768px) {
      .word-card {
        width: calc(50% - 10px);
      }
    }
    @media (max-width: 480px) {
      .word-card {
        width: 100%;
      }
    }
    .card-slider {
      width: 300%;
      height: 100%;
      display: flex;
      transition: transform 0.3s ease;
    }
    .card-face {
      width: 33.333%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      text-align: center;
    }
    .word-face {
      background-color: #fff;
      color: #2c3e50;
    }
    .pronunciation-face {
      background-color: var(--light-gray);
      color: var(--text-gray);
      font-family: 'Arial', sans-serif;
    }
    .meaning-face {
      background-color: var(--meaning-bg);
      color: white;
    }
    .word-text {
      font-size: 1.5rem;
      font-weight: bold;
    }
    .pronunciation-text {
      font-size: 1.3rem;
      font-style: italic;
    }
    .meaning-text {
      font-size: 1.3rem;
    }
    .navigation {
      position: absolute;
      bottom: 10px;
      width: 100%;
      display: flex;
      justify-content: center;
      gap: 8px;
    }
    .nav-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: #bdc3c7;
      cursor: pointer;
    }
    .nav-dot.active {
      background-color: #415163;
    }
    
    /* AI ë¬¸ì¥ ìƒì„± ê¸°ëŠ¥ CSS */
    .generate-btn {
      position: absolute;
      right: 50px;
      top: 50%;
      transform: translateY(-50%);
      padding: 4px 8px;
      font-size: 0.8rem;
      background-color: var(--accent-blue);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      min-width: 90px;
      text-align: center;
      transition: background-color 0.2s;
    }
    .generate-btn:hover {
      background-color: var(--accent-blue-dark);
    }
    .generate-btn:disabled {
      background-color: #95a5a6;
      cursor: not-allowed;
    }
    .sentence-display {
      background-color: #ecf0f1;
      border-left: 4px solid var(--accent-blue);
      padding: 15px;
      margin-top: 15px;
      border-radius: 4px;
      font-style: italic;
      color: #34495e;
      display: none;
      white-space: pre-wrap;
      position: relative;
    }
    .sentence-controls {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    .tts-btn {
      padding: 2px 6px;
      font-size: 0.7rem;
      background-color: #27ae60;
      color: white;
      border: none;
      border-radius: 3px;
      cursor: pointer;
    }
    .tts-btn:hover {
      background-color: #219a52;
    }
    .tts-btn:disabled {
      background-color: #95a5a6;
      cursor: not-allowed;
    }
    .sentence-text {
      font-size: 1.1rem;
      margin-bottom: 10px;
      line-height: 1.4;
    }
    .korean-translation {
      font-size: 0.9rem;
      color: #7f8c8d;
      font-style: normal;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <!-- ë¡œê·¸ì¸ í™”ë©´ -->
  <div id="login-screen" style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh;">
    <h2>ë¡œê·¸ì¸</h2>
    <input type="password" id="password-input" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" style="padding: 8px; font-size: 1rem; margin-bottom: 10px;"/>
    <button id="login-btn" style="padding: 8px 16px; font-size: 1rem;">ë¡œê·¸ì¸</button>
    <p id="login-error" style="color: red; visibility: hidden; margin-top: 8px;">ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
  </div>

  <!-- ì‹¤ì œ ì•± í™”ë©´ -->
  <div id="app" style="display: none;">
    <div class="container">
      <header>
        <h1>AI ì˜ì–´ ë‹¨ì–´ í•™ìŠµ ì•±</h1>
      </header>
      <div class="lang-tabs">
        <button class="lang-btn active" data-face="0">English</button>
        <button class="lang-btn" data-face="2">í•œê¸€</button>
      </div>
      <p class="instructions">
        â€¢ ì¹´ë“œ í´ë¦­ ì‹œ ì˜ì–´ ë‹¨ì–´ë©´ì—ì„œ ì›ì–´ë¯¼ ëª©ì†Œë¦¬ë¡œ ë°œìŒì´ ì¬ìƒë©ë‹ˆë‹¤.<br/>
        â€¢ 'ë¬¸ì¥ ë§Œë“¤ê¸°' ë²„íŠ¼ìœ¼ë¡œ AIê°€ ìœ ë‹› ë‹¨ì–´ë¥¼ í™œìš©í•´ ë§¤ë²ˆ ë‹¤ë¥¸ ì˜ˆë¬¸ì„ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.<br/>
        â€¢ ìƒì„±ëœ ë¬¸ì¥ì€ ì˜ì–´/í•œêµ­ì–´ ìŒì„±ìœ¼ë¡œ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </p>
      <div id="chapters-list">
        <div class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</div>
      </div>
    </div>
  </div>

  <script>
    const CORRECT_PASSWORD = '0410';
    let defaultFaceIndex = 0;
    let englishVoice = null;
    let koreanVoice = null;
    let generator = null; // ì˜¨ë””ë°”ì´ìŠ¤ AI ìƒì„±ê¸°

    // ë¡œê·¸ì¸ ì²˜ë¦¬
    document.getElementById('login-btn').addEventListener('click', () => {
      const pwd = document.getElementById('password-input').value;
      if (pwd === CORRECT_PASSWORD) {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        loadVoices();
        initializeApp();
      } else {
        document.getElementById('login-error').style.visibility = 'visible';
      }
    });

    // ë‹¨ì–´ ë°ì´í„° (ê¸°ì¡´ê³¼ ë™ì¼)
    const vocabData = [
      { title: "Unit 1: Special Days", words: [
        { word: "Valentine's Day", pronunciation: "/ËˆvÃ¦lÉ™ntaÉªnz deÉª/", meaning: "ë°œë Œíƒ€ì¸ ë°ì´" },
        { word: "Earth Day", pronunciation: "/ÉœËrÎ¸ deÉª/", meaning: "ì§€êµ¬ì˜ ë‚ " },
        { word: "Mother's Day", pronunciation: "/ËˆmÊŒÃ°É™rz deÉª/", meaning: "ì–´ë¨¸ë‹ˆì˜ ë‚ " },
        { word: "Thanksgiving", pronunciation: "/ËŒÎ¸Ã¦Å‹ksËˆÉ¡ÉªvÉªÅ‹/", meaning: "ì¶”ìˆ˜ê°ì‚¬ì ˆ" },
        { word: "Halloween", pronunciation: "/ËŒhÃ¦lÉ™ËˆwiËn/", meaning: "í• ë¡œìœˆ" },
        { word: "Christmas Day", pronunciation: "/ËˆkrÉªsmÉ™s deÉª/", meaning: "í¬ë¦¬ìŠ¤ë§ˆìŠ¤" },
        { word: "favorite", pronunciation: "/ËˆfeÉªvÉ™rÉªt/", meaning: "ê°€ì¥ ì¢‹ì•„í•˜ëŠ”" },
        { word: "day", pronunciation: "/deÉª/", meaning: "ë‚ " },
        { word: "my", pronunciation: "/maÉª/", meaning: "ë‚˜ì˜" },
        { word: "his", pronunciation: "/hÉªz/", meaning: "ê·¸ì˜" },
        { word: "her", pronunciation: "/hÉœËr/", meaning: "ê·¸ë…€ì˜" },
        { word: "what", pronunciation: "/wÉ‘Ët/", meaning: "ë¬´ì—‡" },
        { word: "look", pronunciation: "/lÊŠk/", meaning: "ë³´ë‹¤" },
        { word: "make", pronunciation: "/meÉªk/", meaning: "ë§Œë“¤ë‹¤" },
        { word: "cards", pronunciation: "/kÉ‘Ërdz/", meaning: "ì¹´ë“œ" },
        { word: "give", pronunciation: "/É¡Éªv/", meaning: "ì£¼ë‹¤" },
        { word: "presents", pronunciation: "/ËˆprezÉ™nts/", meaning: "ì„ ë¬¼" },
        { word: "eat", pronunciation: "/iËt/", meaning: "ë¨¹ë‹¤" },
        { word: "turkey", pronunciation: "/ËˆtÉœËrki/", meaning: "ì¹ ë©´ì¡°" },
        { word: "mom", pronunciation: "/mÉ‘Ëm/", meaning: "ì—„ë§ˆ" },
        { word: "I", pronunciation: "/aÉª/", meaning: "ë‚˜" },
        { word: "you", pronunciation: "/juË/", meaning: "ë„ˆ" },
        { word: "he", pronunciation: "/hiË/", meaning: "ê·¸" },
        { word: "she", pronunciation: "/ÊƒiË/", meaning: "ê·¸ë…€" },
        { word: "we", pronunciation: "/wiË/", meaning: "ìš°ë¦¬" },
        { word: "they", pronunciation: "/Ã°eÉª/", meaning: "ê·¸ë“¤" },
        { word: "love", pronunciation: "/lÊŒv/", meaning: "ì‚¬ë‘í•˜ë‹¤" },
        { word: "happy", pronunciation: "/ËˆhÃ¦pi/", meaning: "í–‰ë³µí•œ" },
        { word: "special", pronunciation: "/ËˆspeÊƒÉ™l/", meaning: "íŠ¹ë³„í•œ" },
        { word: "celebrate", pronunciation: "/ËˆselÉ™breÉªt/", meaning: "ì¶•í•˜í•˜ë‹¤" }
      ]},
      { title: "Unit 2: Today's Weather", words: [
        { word: "sunny", pronunciation: "/ËˆsÊŒni/", meaning: "ë§‘ì€" },
        { word: "rainy", pronunciation: "/ËˆreÉªni/", meaning: "ë¹„ê°€ ë‚´ë¦¬ëŠ”" },
        { word: "cloudy", pronunciation: "/ËˆklaÊŠdi/", meaning: "êµ¬ë¦„ ë‚€" },
        { word: "windy", pronunciation: "/ËˆwÉªndi/", meaning: "ë°”ëŒì´ ë¶€ëŠ”" },
        { word: "snowy", pronunciation: "/ËˆsnoÊŠi/", meaning: "ëˆˆì´ ë‚´ë¦¬ëŠ”" },
        { word: "weather", pronunciation: "/ËˆweÃ°É™r/", meaning: "ë‚ ì”¨" },
        { word: "today", pronunciation: "/tÉ™ËˆdeÉª/", meaning: "ì˜¤ëŠ˜" },
        { word: "hot", pronunciation: "/hÉ‘Ët/", meaning: "ë”ìš´" },
        { word: "cold", pronunciation: "/koÊŠld/", meaning: "ì¶”ìš´" },
        { word: "warm", pronunciation: "/wÉ”Ërm/", meaning: "ë”°ëœ»í•œ" },
        { word: "cool", pronunciation: "/kuËl/", meaning: "ì‹œì›í•œ" },
        { word: "beautiful", pronunciation: "/ËˆbjuËtÉªfÉ™l/", meaning: "ì•„ë¦„ë‹¤ìš´" },
        { word: "nice", pronunciation: "/naÉªs/", meaning: "ì¢‹ì€" },
        { word: "terrible", pronunciation: "/ËˆterÉ™bÉ™l/", meaning: "ë”ì°í•œ" },
        { word: "outside", pronunciation: "/ËŒaÊŠtËˆsaÉªd/", meaning: "ë°–ì—" },
        { word: "inside", pronunciation: "/ËŒÉªnËˆsaÉªd/", meaning: "ì•ˆì—" },
        { word: "umbrella", pronunciation: "/ÊŒmËˆbrelÉ™/", meaning: "ìš°ì‚°" },
        { word: "jacket", pronunciation: "/ËˆdÊ’Ã¦kÉªt/", meaning: "ì¬í‚·" },
        { word: "stay", pronunciation: "/steÉª/", meaning: "ë¨¸ë¬´ë¥´ë‹¤" },
        { word: "go", pronunciation: "/É¡oÊŠ/", meaning: "ê°€ë‹¤" }
      ]},
      { title: "Unit 3: Food & Shopping", words: [
        { word: "apple", pronunciation: "/ËˆÃ¦pÉ™l/", meaning: "ì‚¬ê³¼" },
        { word: "banana", pronunciation: "/bÉ™ËˆnÃ¦nÉ™/", meaning: "ë°”ë‚˜ë‚˜" },
        { word: "orange", pronunciation: "/ËˆÉ”ËrÉªndÊ’/", meaning: "ì˜¤ë Œì§€" },
        { word: "bread", pronunciation: "/bred/", meaning: "ë¹µ" },
        { word: "milk", pronunciation: "/mÉªlk/", meaning: "ìš°ìœ " },
        { word: "cheese", pronunciation: "/tÊƒiËz/", meaning: "ì¹˜ì¦ˆ" },
        { word: "chicken", pronunciation: "/ËˆtÊƒÉªkÉªn/", meaning: "ë‹­ê³ ê¸°" },
        { word: "rice", pronunciation: "/raÉªs/", meaning: "ìŒ€" },
        { word: "water", pronunciation: "/ËˆwÉ”ËtÉ™r/", meaning: "ë¬¼" },
        { word: "juice", pronunciation: "/dÊ’uËs/", meaning: "ì£¼ìŠ¤" },
        { word: "buy", pronunciation: "/baÉª/", meaning: "ì‚¬ë‹¤" },
        { word: "sell", pronunciation: "/sel/", meaning: "íŒ”ë‹¤" },
        { word: "store", pronunciation: "/stÉ”Ër/", meaning: "ê°€ê²Œ" },
        { word: "market", pronunciation: "/ËˆmÉ‘ËrkÉªt/", meaning: "ì‹œì¥" },
        { word: "fresh", pronunciation: "/freÊƒ/", meaning: "ì‹ ì„ í•œ" },
        { word: "delicious", pronunciation: "/dÉªËˆlÉªÊƒÉ™s/", meaning: "ë§›ìˆëŠ”" },
        { word: "healthy", pronunciation: "/ËˆhelÎ¸i/", meaning: "ê±´ê°•í•œ" },
        { word: "expensive", pronunciation: "/ÉªkËˆspensÉªv/", meaning: "ë¹„ì‹¼" },
        { word: "cheap", pronunciation: "/tÊƒiËp/", meaning: "ì‹¼" },
        { word: "hungry", pronunciation: "/ËˆhÊŒÅ‹É¡ri/", meaning: "ë°°ê³ í”ˆ" }
      ]}
    ];

    // ìŒì„± ë¡œë“œ
    function loadVoices() {
      const voices = window.speechSynthesis.getVoices();
      englishVoice = voices.find(v => v.lang === 'en-US') || voices.find(v => v.lang.startsWith('en')) || null;
      koreanVoice = voices.find(v => v.lang === 'ko-KR') || voices.find(v => v.lang.startsWith('ko')) || null;
    }
    window.speechSynthesis.onvoiceschanged = loadVoices;

    // ì¹´ë“œ ë¦¬ì…‹
    function resetAllCards() {
      document.querySelectorAll('.word-card').forEach(card => {
        const slider = card.querySelector('.card-slider');
        const nav = card.querySelector('.navigation');
        slider.style.transform = `translateX(-${defaultFaceIndex * 33.333}%)`;
        nav.querySelectorAll('.nav-dot').forEach((d, i) => d.classList.toggle('active', i === defaultFaceIndex));
      });
    }

    // ì•± ì´ˆê¸°í™”
    function initializeApp() {
      const container = document.getElementById('chapters-list');
      container.innerHTML = '';
      
      vocabData.forEach((chapter, idx) => {
        const chapDiv = document.createElement('div');
        chapDiv.className = 'chapter-container';

        const title = document.createElement('div');
        title.className = 'chapter-title';
        title.innerHTML = `
          <span>${chapter.title}</span>
          <button class="generate-btn">ë¬¸ì¥ ë§Œë“¤ê¸°</button>
          <span class="chapter-toggle">â–¼</span>
        `;

        const sentenceDisplay = document.createElement('div');
        sentenceDisplay.className = 'sentence-display';

        const wordsDiv = document.createElement('div');
        wordsDiv.className = 'words-container';
        if (idx === 0) {
          wordsDiv.classList.add('expanded');
          title.querySelector('.chapter-toggle').textContent = 'â–²';
        }

        chapter.words.forEach(word => wordsDiv.appendChild(createWordCard(word)));

        title.addEventListener('click', e => {
          if (e.target.classList.contains('generate-btn')) return;
          wordsDiv.classList.toggle('expanded');
          title.querySelector('.chapter-toggle').textContent = wordsDiv.classList.contains('expanded') ? 'â–²' : 'â–¼';
        });

        title.querySelector('.generate-btn').addEventListener('click', e => {
          const btn = e.target;
          generateSentenceWithLocalAI(chapter.words, sentenceDisplay, btn);
        });

        chapDiv.append(title, sentenceDisplay, wordsDiv);
        container.append(chapDiv);
      });
    }

    // ë‹¨ì–´ ì¹´ë“œ ìƒì„±
    function createWordCard(data) {
      const card = document.createElement('div');
      card.className = 'word-card';
      
      const slider = document.createElement('div');
      slider.className = 'card-slider';
      
      let currentIndex = defaultFaceIndex;
      const faces = [
        { cls: 'word-face', text: data.word },
        { cls: 'pronunciation-face', text: data.pronunciation },
        { cls: 'meaning-face', text: data.meaning }
      ];

      faces.forEach(face => {
        const div = document.createElement('div');
        div.className = `card-face ${face.cls}`;
        div.innerHTML = `<div class="${face.cls.replace('-face','')}-text">${face.text}</div>`;
        slider.appendChild(div);
      });

      slider.style.transform = `translateX(-${currentIndex * 33.333}%)`;

      const nav = document.createElement('div');
      nav.className = 'navigation';
      faces.forEach((_, i) => {
        const dot = document.createElement('div');
        dot.className = i === currentIndex ? 'nav-dot active' : 'nav-dot';
        dot.dataset.idx = i;
        dot.addEventListener('click', e => {
          e.stopPropagation();
          currentIndex = i;
          slider.style.transform = `translateX(-${i * 33.333}%)`;
          nav.querySelectorAll('.nav-dot').forEach((d, di) => d.classList.toggle('active', di === i));
          if (i === 0 && 'speechSynthesis' in window) {
            const utter = new SpeechSynthesisUtterance(faces[i].text);
            if (englishVoice) utter.voice = englishVoice;
            speechSynthesis.speak(utter);
          }
        });
        nav.appendChild(dot);
      });

      card.append(slider, nav);
      card.addEventListener('click', () => {
        currentIndex = (currentIndex + 1) % faces.length;
        slider.style.transform = `translateX(-${currentIndex * 33.333}%)`;
        nav.querySelectorAll('.nav-dot').forEach((d, di) => d.classList.toggle('active', di === currentIndex));
        if (currentIndex === 0 && 'speechSynthesis' in window) {
          const utter = new SpeechSynthesisUtterance(faces[currentIndex].text);
          if (englishVoice) utter.voice = englishVoice;
          speechSynthesis.speak(utter);
        }
      });

      return card;
    }

    // ì˜¨ë””ë°”ì´ìŠ¤ AI ë¬¸ì¥ ìƒì„± (ë§¤ë²ˆ ë‹¤ë¥¸ ë¬¸ì¥)
    async function generateSentenceWithLocalAI(wordList, displayElement, buttonElement) {
      buttonElement.disabled = true;
      displayElement.style.display = 'block';

      try {
        if (!generator) {
          displayElement.innerHTML = '<div class="sentence-text">AI ëª¨ë¸ì„ ì²˜ìŒ ë¡œë“œí•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤... (ì•½ 10~20ì´ˆ ì†Œìš”)</div>';
          const { pipeline } = await import('https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1');
          generator = await pipeline('text-generation', 'Xenova/distilgpt2');
        }

        displayElement.innerHTML = '<div class="sentence-text">AIê°€ ìƒˆë¡œìš´ ë¬¸ì¥ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>';

        const availableWords = wordList.map(item => item.word.toLowerCase().split(' ')[0]);
        const uniqueWords = [...new Set(availableWords)];

        // ëœë¤ ìš”ì†Œ ì¶”ê°€ë¡œ ë§¤ë²ˆ ë‹¤ë¥¸ ë¬¸ì¥ ìƒì„±
        const randomPrompts = [
          `Write a simple sentence using these words: ${uniqueWords.slice(0, 5).join(', ')}.`,
          `Create a short sentence with: ${uniqueWords.slice(2, 7).join(', ')}.`,
          `Make a basic sentence using: ${uniqueWords.slice(1, 6).join(', ')}.`,
          `Form a sentence with these words: ${uniqueWords.slice(0, 4).join(', ')}.`
        ];
        
        const randomIndex = Math.floor(Math.random() * randomPrompts.length);
        const prompt = randomPrompts[randomIndex];

        const result = await generator(prompt, {
          max_new_tokens: 15,
          temperature: 0.8,      // ë†’ì€ ì˜¨ë„ë¡œ ì°½ì˜ì„± ì¦ê°€
          do_sample: true,       // ìƒ˜í”Œë§ìœ¼ë¡œ ë‹¤ì–‘ì„± í™•ë³´
          top_k: 50,            // ìƒìœ„ 50ê°œ ë‹¨ì–´ì—ì„œ ì„ íƒ
          num_return_sequences: 1,
          pad_token_id: 50256,  // GPT-2 ëª¨ë¸ì˜ íŒ¨ë”© í† í°
        });

        let generatedSentence = result[0].generated_text;
        
        // í”„ë¡¬í”„íŠ¸ ì œê±°
        if (generatedSentence.includes('.')) {
          const sentences = generatedSentence.split('.');
          generatedSentence = sentences[sentences.length - 2] + '.';
        }
        
        generatedSentence = generatedSentence.replace(prompt, '').trim();
        
        if (!generatedSentence || generatedSentence.length < 5) {
          const fallbackSentences = [
            "I love special days.",
            "Today is sunny and nice.",
            "We buy fresh apples.",
            "My mom makes delicious food.",
            "The weather is beautiful today."
          ];
          generatedSentence = fallbackSentences[Math.floor(Math.random() * fallbackSentences.length)];
        }

        // ë²ˆì—­ (ê°„ë‹¨í•œ ë²ˆì—­ ë§¤í•‘)
        const translations = {
          "I love special days.": "ë‚˜ëŠ” íŠ¹ë³„í•œ ë‚ ë“¤ì„ ì¢‹ì•„í•©ë‹ˆë‹¤.",
          "Today is sunny and nice.": "ì˜¤ëŠ˜ì€ ë§‘ê³  ì¢‹ì€ ë‚ ì…ë‹ˆë‹¤.",
          "We buy fresh apples.": "ìš°ë¦¬ëŠ” ì‹ ì„ í•œ ì‚¬ê³¼ë¥¼ ì‚½ë‹ˆë‹¤.",
          "My mom makes delicious food.": "ìš°ë¦¬ ì—„ë§ˆëŠ” ë§›ìˆëŠ” ìŒì‹ì„ ë§Œë“­ë‹ˆë‹¤.",
          "The weather is beautiful today.": "ì˜¤ëŠ˜ ë‚ ì”¨ëŠ” ì•„ë¦„ë‹µìŠµë‹ˆë‹¤."
        };

        const koreanTranslation = translations[generatedSentence] || "ìƒì„±ëœ ë¬¸ì¥ì˜ í•œêµ­ì–´ ë²ˆì—­";

        displayElement.innerHTML = `
          <div class="sentence-text">${generatedSentence}</div>
          <div class="korean-translation">${koreanTranslation}</div>
          <div class="sentence-controls">
            <button class="tts-btn" onclick="speakText('${generatedSentence}', 'en')">ğŸ”Š ì˜ì–´ë¡œ ì½ê¸°</button>
            <button class="tts-btn" onclick="speakText('${koreanTranslation}', 'ko')">ğŸ”Š í•œêµ­ì–´ë¡œ ì½ê¸°</button>
          </div>
        `;

      } catch (error) {
        console.error('AI ë¬¸ì¥ ìƒì„± ì˜¤ë¥˜:', error);
        displayElement.innerHTML = '<div class="sentence-text">ë¬¸ì¥ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</div>';
      } finally {
        buttonElement.disabled = false;
      }
    }

    // TTS í•¨ìˆ˜
    function speakText(text, lang) {
      if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(text);
        if (lang === 'en' && englishVoice) {
          utterance.voice = englishVoice;
        } else if (lang === 'ko' && koreanVoice) {
          utterance.voice = koreanVoice;
        }
        utterance.lang = lang === 'en' ? 'en-US' : 'ko-KR';
        speechSynthesis.speak(utterance);
      }
    }

    // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡
    window.speakText = speakText;

    // ì–¸ì–´ íƒ­ ì´ë²¤íŠ¸
    document.querySelectorAll('.lang-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        defaultFaceIndex = parseInt(btn.dataset.face);
        initializeApp();
      });
    });
  </script>
</body>
</html>
